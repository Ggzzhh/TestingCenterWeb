{% extends 'admin/base.html' %}
{% import "bootstrap/wtf.html" as wtf %}

{% block page_content %}
	<div class="container">
		<div class="page-header">
			<h1>设置</h1>
		</div>
		<form>
			<div class="form-group">
				<label for="corporate_name">公司名称</label>
				<input type="text" class="form-control" placeholder="None"
							 name="corporate_name"/>
			</div>
			<div class="form-group">
				<label for="contacts">联系人</label>
				<input type="text" class="form-control" placeholder="None"
							 name="contacts">
			</div>
			<div class="form-group">
				<label for="phone_num">联系电话</label>
				<input type="tel" class="form-control" placeholder="None"
							 name="phone_num">
			</div>
			<div class="form-group">
				<label for="address">办公地址</label>
				<input type="text" class="form-control" placeholder="None" name="address">
			</div>
			<div class="form-group">
				<label for="WeChat">邮 箱</label>
				<input type="email" class="form-control" placeholder="None" name="email">
			</div>
			<div class="form-group">
				<label for="WeChat">新浪微博</label>
				<input type="text" class="form-control" placeholder="None" name="sina_blog">
			</div>
			<div class="form-group">
				<label for="WeChat">微信号或公众号</label>
				<input type="text" class="form-control" placeholder="None" name="WeChat">
			</div>
			<div class="form-group">
				<label for="WeChat_img">微信二维码</label>
				<div class="img-rounded">
					<img src="{{ url_for('static', filename='image/logo.jpg') }}" alt=""
							 class="img-thumbnail" id="uploadPreview" width="200"
							 height="200">
				</div>
				<br />
				<input id="uploadImage" type="file" name="WeChat_img" accept="image/*"
				/>
				<p class="help-block">图片大小不要超过2M, 切保存时会保存为jpeg</p>
			</div>
			<div class="form-group">
				<label for="about_me">关于我们</label>
				<textarea type="text" class="form-control" placeholder="网站上的关于公司的介绍"
									name="about_me" rows="3"></textarea>
			</div>
			<button class="btn btn-info" >提 交</button>
		</form>
	</div>
{% endblock page_content %}


{% block scripts %}
	{{ super() }}
	<script>
      if (typeof FileReader === 'undefined') {
          $('p').text("您的浏览器版本过低，无法使用图片预览功能，请尽快升级");
          $("#uploadImage").attr("hidden", "True");
      }

      // todo: 获取表单


      $("#uploadImage").change(function () {
          upLoadImage(this.files[0], 'uploadPreview');
      });

      $('button').click(function (e) {
          e.preventDefault();
          // 获取表单的数据 以json形式
          var json_data = $('form').serializeJSON();
          // console.log(json_data);
          var WeChat_img = document.getElementById('uploadPreview').src
          json_data.WeChat_img = WeChat_img;
          console.log(json_data);
          // 提交并更新数据
					// todo 把发送来的数据类型从bytes转为json
					// 现在json_data 的类型是bytes
          $.ajax({
              type: 'POST',
              url: "{{ url_for('api.update_web_setting') }}",
              data: json_data,
              dataType: 'json',
              contentType: 'application/json;',
              success: function (data) {
                  console.log(data);
              },
              error: function (xhr, type) {
                  alert(xhr, type);
              }
          })
      });
	</script>
{% endblock scripts %}